# 국제화(다국어)

VS Code 개발 도구를 사용하는 경우, [I18n-ally](https://marketplace.visualstudio.com/items?itemName=Lokalise.i18n-ally) 플러그인을 설치하는 것을 추천합니다.

## I18n-ally 플러그인

이 플러그인을 설치한 후, 코드 내에서 실시간으로 해당 언어의 내용을 확인할 수 있습니다.

![](/images/i18n.png)

## 기본 언어 설정

[src/config/locale.ts](https://github.com/web2-solution/web2-vue-framework/tree/demo/src/locales) 파일에서 `currentLocale`을 다른 언어로 설정합니다.

```ts
import { useCache } from '@/hooks/web/useCache'
import zhCn from 'element-plus/lib/locale/lang/zh-cn'
import en from 'element-plus/lib/locale/lang/en'

const { wsCache } = useCache()

export const elLocaleMap = {
  'zh-CN': zhCn,
  en: en
}
export interface LocaleState {
  currentLocale: LocaleDropdownType
  localeMap: LocaleDropdownType[]
}

export const localeModules: LocaleState = {
  currentLocale: {
    lang: wsCache.get('lang') || 'zh-CN',
    elLocale: elLocaleMap[wsCache.get('lang') || 'zh-CN']
  },
  // 다국어
  localeMap: [
    {
      lang: 'zh-CN',
      name: '简体中文' // 중국어 간체
    },
    {
      lang: 'en',
      name: 'English'
    }
  ]
}

```

## 언어 파일

[src/locales](https://github.com/web2-solution/web2-vue-framework/tree/demo/src/locales)에서 구체적인 언어를 설정할 수 있습니다. 현재 프로젝트의 언어는 모두 하나의 파일에 통합되어 있으며, 나중에 분리하여 유지 관리하기 쉽게 할 계획입니다.


## 언어파일을 가져오는 로직
[src/plugins/vueI18n/index.ts](https://github.com/web2-solution/web2-vue-framework/blob/demo/src/plugins/vueI18n/index.ts)파일에서 확인할 수 있습니다.

```ts
const defaultLocal = await import(`../../locales/${locale.lang}.ts`)
```

이렇게 하면 `src/locales` 폴더의 언어 파일이 가져와집니다.

## 활용

프로젝트에서 제공하는 useI18n을 사용하세요. **vue-i18n의 useI18n은 사용하지 마세요.**

```ts
import { useI18n } from '/@/hooks/web/useI18n'

const { t } = useI18n()

const title = t('common.menu')
```

## 언어 변경

언어를 변경하려면 [src/locales/useLocale.ts](https://github.com/web2-solution/web2-vue-framework/blob/demo/src/hooks/web/useLocale.ts)를 사용해야 합니다.

```ts
import { useLocale } from '@/hooks/web/useLocale'
const { changeLocale } = useLocale()

changeLocale('en')
```

## 추가

### 언어 파일

[src/locales](https://github.com/web2-solution/web2-vue-framework/tree/demo/src/locales)에 해당 언어에 대한 파일을 추가하면 됩니다.

### 새 언어 추가

현재 프로젝트에 기본 제공되는 언어는 `zh_CN` (간체 중국어)과 `en` (영어) 두 가지입니다.

새 언어를 추가하려면, 다음 단계를 따르면 됩니다.

1. [src/locales](https://github.com/web2-solution/web2-vue-framework/tree/demo/src/locales)폴더에 언어 파일을 추가합니다.
2. [types/global.d.ts](https://github.com/web2-solution/web2-vue-framework/blob/demo/types/global.d.ts) 파일에서 `LocaleType`에 해당 언어의 타입을 추가합니다.
3. [src/config/locale.ts](https://github.com/web2-solution/web2-vue-framework/tree/demo/src/locales) `localeMap`에 해당 언어를 
추가합니다.

## 원격 언어 데이터 읽기

현재 프로젝트는 `src/main.ts` 에서 `setupI18n`함수가 실행된 후에 화면을 렌더링 합니다.

따라서 `setupI18n`내의 `createI18nOptions`에서 AJAX 요청을 보내고, 해당 데이터를 i18n 인스턴스에 설정하면 됩니다.

```ts
const createI18nOptions = async (): Promise<I18nOptions> => {
  const localeStore = useLocaleStoreWithOut()
  const locale = localeStore.getCurrentLocale
  const localeMap = localeStore.getLocaleMap
  // 여기서 원격 요청으로 변경하면 됩니다.
  const defaultLocal = await import(`../../locales/${locale.lang}.ts`)
  const message = defaultLocal.default ?? {}

  setHtmlPageLang(locale.lang)

  localeStore.setCurrentLocale({
    lang: locale.lang
    // elLocale: elLocal
  })

  return {
    legacy: false,
    locale: locale.lang,
    fallbackLocale: locale.lang,
    messages: {
      [locale.lang]: message
    },
    availableLocales: localeMap.map((v) => v.lang),
    sync: true,
    silentTranslationWarn: true,
    missingWarn: false,
    silentFallbackWarn: true
  }
}
```

### useLocale

코드: [src/hooks/web/useLocale/](https://github.com/web2-solution/web2-vue-framework/blob/demo/src/hooks/web/useLocale.ts)

언어를 수동으로 변경할 때 `uselocale` 함수가 호출됩니다. `uselocale` 함수도 비동기 함수이르모, 인터페이스에서 응답 데이터를 반환할 때까지 기다린 후에 설정하면 됩니다.

```ts
export const useLocale = () => {
  // Switching the language will change the locale of useI18n
  // And submit to configuration modification
  const changeLocale = async (locale: LocaleType) => {
    const globalI18n = i18n.global
    
    // 원격으로 가져오도록 변경
    const langModule = await import(`../../locales/${locale}.ts`)

    globalI18n.setLocaleMessage(locale, langModule.default)

    setI18nLanguage(locale)
  }

  return {
    changeLocale
  }
}
```
